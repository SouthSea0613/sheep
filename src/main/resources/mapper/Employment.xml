<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com._401unauthorized.sheep.dao.EmploymentDao">

    <!--글을 쓰자!-->
    <insert id="write" useGeneratedKeys="true" keyProperty="board_number">
        INSERT INTO BOARD (BOARD_NUMBER, USER_ID, BOARD_TITLE, BOARD_CONTENT, BOARD_REGDATE, BOARD_KIND)
        VALUES (null, #{user_id}, #{board_title}, #{board_content}, default, 2)
    </insert>

    <insert id="insert_job">
        INSERT INTO JOB_BOARD (BOARD_NUMBER, JOB_COUNT, JOB_AREA, JOB_STATUS) VALUES (#{board_number}, #{job_count}, #{job_area}, 0)
    </insert>

    <insert id="resume_write" useGeneratedKeys="true" keyProperty="board_number">
        INSERT INTO BOARD VALUES (NULL, #{user_id}, #{board_title}, #{board_content}, 0, DEFAULT, 3)
    </insert>

    <insert id="resume_write2">
        INSERT INTO EMPLOYEE VALUES (#{board_number}, #{parent_board_number}, #{user_id}, 0)
    </insert>

    <select id="list" resultType="com._401unauthorized.sheep.dto.BoardDto">
        SELECT
            JB.JOB_AREA, B.BOARD_NUMBER, B.BOARD_TITLE, B.USER_ID, B.BOARD_REGDATE, B.BOARD_STATUS, JB.JOB_COUNT
        FROM BOARD B
                 JOIN JOB_BOARD JB
                      ON B.BOARD_NUMBER = JB.BOARD_NUMBER
        WHERE BOARD_KIND = 2
    </select>

    <select id="detail" resultType="com._401unauthorized.sheep.dto.BoardDto">
        SELECT
            B.BOARD_NUMBER, B.BOARD_TITLE, B.USER_ID, B.BOARD_CONTENT, B.BOARD_REGDATE, JB.JOB_COUNT, JB.JOB_AREA, S.SELLER_COMPANY
        FROM
            BOARD B
                JOIN JOB_BOARD JB ON B.BOARD_NUMBER = JB.BOARD_NUMBER
                JOIN SELLER S ON B.USER_ID = S.USER_ID
        WHERE B.BOARD_NUMBER = 1
    </select>

    <select id="get_board_list" resultType="com._401unauthorized.sheep.dto.BoardDto">
        SELECT
            JB.JOB_AREA, B.BOARD_NUMBER, B.BOARD_TITLE, B.USER_ID, B.BOARD_REGDATE, JB.JOB_STATUS, JB.JOB_COUNT
        FROM BOARD B
                 JOIN JOB_BOARD JB
                      ON B.BOARD_NUMBER = JB.BOARD_NUMBER
        WHERE BOARD_KIND = 2 AND JOB_STATUS  =0
    </select>

    <update id="complete">
        UPDATE JOB_BOARD
        SET JOB_STATUS = 1
        WHERE BOARD_NUMBER = #{board_number}
    </update>

    <select id="resume_detail" resultType="com._401unauthorized.sheep.dto.BoardDto">
        SELECT
            B.BOARD_NUMBER AS PARENT_BOARD_NUMBER, E.BOARD_NUMBER, E.BOARD_TITLE, E.USER_ID, U.USER_NAME, U.USER_PHONE ,B.BOARD_CONTENT
        FROM BOARD B
                 JOIN EMPLOYEE E ON B.BOARD_NUMBER = E.PARENT_BOARD_NUMBER
                 JOIN USER U ON E.USER_ID = U.USER_ID
        WHERE B.BOARD_NUMBER = #{board_number}
    </select>
</mapper>