<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com._401unauthorized.sheep.dao.TakeoffDao">
    <insert id="call">
        INSERT INTO APPLY_STATUS
        VALUES (#{user_id}, #{wish_number}, #{apply_status})
    </insert>
    <update id="update_status">
        UPDATE APPLY_STATUS SET APPLY_STATUS = #{wish_number} WHERE WISH_NUMBER = #{wish_number}
    </update>

    <select id="get_category_detail" resultType="com._401unauthorized.sheep.dto.CategoryDto">
        SELECT MC.WISH_NUMBER, MC.CATEGORY_NUMBER AS CATEGORY_PARENT, C.CATEGORY_NUMBER, MC.MAJOR_TEXT
        FROM MAJOR_CATEGORY_CONTENT MC
        LEFT JOIN(
            SELECT C.CATEGORY_NUMBER, C.CATEGORY_PARENT, S.WISH_NUMBER
            FROM CATEGORY C
            JOIN SUB_CATEGORY S
            ON C.CATEGORY_NUMBER = S.CATEGORY_NUMBER) C
        ON C.CATEGORY_PARENT = MC.CATEGORY_NUMBER
        AND C.WISH_NUMBER = MC.WISH_NUMBER
        WHERE MC.WISH_NUMBER = #{wish_number}
    </select>
    <select id="list" resultType="com._401unauthorized.sheep.dto.TakeoffDto">
        SELECT W.USER_ID,SUM(W.WISH_CATEGORY_SELLER_PRICE) AS WISH_CATEGORY_SELLER_PRICE,A.APPLY_STATUS
        FROM WISH_CATEGORY_SELLER W
            JOIN APPLY_STATUS A
                ON W.USER_ID=A.USER_ID
                       AND W.WISH_NUMBER = A.WISH_NUMBER
        WHERE W.WISH_NUMBER=#{wishNumber}
        GROUP BY W.USER_ID,W.WISH_CATEGORY_SELLER_PRICE,A.APPLY_STATUS;
    </select>
    <select id="my_list" resultType="com._401unauthorized.sheep.dto.TakeoffDto">
        SELECT W.WISH_TITLE FROM WISH W JOIN WISH_CATEGORY_SELLER S ON W.WISH_NUMBER = S.WISH_NUMBER WHERE S.USER_ID=#{userid};
    </select>
</mapper>