<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/css/headerfooter.css">
    <link rel="stylesheet" href="/css/takeoff.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script defer src="/javascript/common.js"></script>
</head>
<body>
<th:block th:replace="~{common/fragment::header}"></th:block>
<div class="main_content">
    <div class="content">
        <form action="/takeoff/seller/write" id="write_form" method="post">
            <h2>견적서 작성</h2>
            <div>
                <!--  위 div는 전체 묶음  -->
                <input type="hidden" name="wish_number" th:value="${wish_dto?.wish_number}">
                <div th:text="${wish_dto?.wish_addr}">주소</div><br>
                <div th:text="${wish_dto?.wish_type}">주거형태</div><br>
                <div th:text="${wish_dto?.wish_size}">평수</div><br>
                <div th:text="${wish_dto?.wish_size_text}">평수상세</div><br>
                <div th:text="${wish_dto?.wish_money}+만원">예산</div><br>

                <th:block th:each="category:${category_list_dto}">
                    <div th:text="${category.major_category}">대분류 넘버</div>
                    <input type="hidden" name="category_number" th:value="${category?.major_category}">
                    <div th:text="${category.major_text}">대분류 텍스트</div><br>
                    <th:block th:each="subcategory:${category.sub_category}">
                        <div th:text="${subcategory}">중분류 넘버</div>
                    </th:block>

                    <div class="takeoff">
                        <input type="text" name="takeoff_content" class="takeoff_content" placeholder="상세하게 적어주세요.">
                    </div>
                    <div class="takeoff_money">
                        <input type="text"
                               oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"
                               name="takeoff_money" class="takeoff_money" placeholder="견적을 적어주세요." onblur="all_money()">만원
                    </div>
                </th:block>
                <div><input type="button" value="견적 저장" onclick="takeoffbtn()"></div>
            </div>

        </form>
        <br>
        <div class="takeoff_all_money">
            합계: <input type="text" id="takeoff_all_money" readonly name="takeoff_all_money">만원
        </div>
    </div>
    <script>
        function takeoffbtn() {
            let takeoff_content_number;
             takeoff_content_number = document.getElementsByClassName("takeoff_content");
             for(let i=0; i<takeoff_content_number.length; i++){
                 if(takeoff_content_number[i].value == ''){
                     alert("상세 견적을 작성 해주세요.")
                     takeoff_content_number[i].focus();
                     return false;
                 }
             }
            $('#write_form').submit();
        }

        function all_money() {
            let total = 0;
            const money_input = document.querySelectorAll(".takeoff_money");
            money_input.forEach(money => {
                total += parseInt(money.value) || 0;
            })
            const all_money_input = document.getElementById("takeoff_all_money")
            all_money_input.value = total;
        }
    </script>
</div>
<th:block th:replace="~{common/fragment::footer}"></th:block>
</body>
</html>